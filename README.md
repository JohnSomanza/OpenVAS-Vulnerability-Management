# Qualys Vulnerability Management On Azure

![Qualys](https://i.imgur.com/tpMdWJb.jpeg)

## Overview

In this project, we will utilize Qualys, a cloud-based service for vulnerability scanning and management, to conduct thorough scans on a Windows virtual machine. Initially, we will install outdated versions of VLC Media Player and Firefox to simulate common security oversights. Additionally, we will modify firewall settings and edit the Windows registry to further expose vulnerabilities within the virtual machine. Following this, we will perform vulnerability scans with Qualys before and after implementing remediation measures, allowing us to assess the impact of updates and security improvements.

## Tools and Resources

- **Microsoft Azure**: To host the Windows VM & the Qualys Virtual Scanner Appliance.
- **Windows 10**: The operating system for the VM.
- **Qualys Virutal Scanner Appliance**: For conducting comprehensive vulnerability scans.
- **https://ftp.mozilla.org/pub/firefox/releases/**: To source outdated software versions of Firefox.
- **https://www.videolan.org/vlc/releases/**: To source outdated software versions of VLC Media Player.
- **MSRC CVE**: For accessing Common Vulnerabilities and Exposures information as well as Solutions.


<details>
<summary><h2><b>Section 1: Initial Setup</b></h2></summary>
  To begin, we start by preparing our virtual environment for the vulnerability assessment. We'll set up a Windows virtual machine, RDP into it, and install outdated versions of software known for their vulnerabilities.<br><br>

  <details>
  <summary><h3>Step 1: Creating a VM on Azure</h3></summary>
  
  - Navigate to the "Virutal machines" service, select "create", then select "Azure virtual machine".
  - Create the VM as seen in the following photos.

![Virtual Machines](https://i.imgur.com/E4hUMgF.png)<br><br>
![Basics](https://i.imgur.com/DakeHl6.png)<br><br>
![Basics](https://i.imgur.com/ldMnDo5.png)<br><br>
![Networking](https://i.imgur.com/Mzn1v1w.png)<br><br>
![Monitoring](https://i.imgur.com/sq8Iiqb.png)<br><br>

  </details>

  <details>
  <summary><h3>Step 2: Installing Outdated Applications</h3></summary>

  - RDP into your newly created VM and open Microsoft edge.
  - Copy and paste the following links to download outdated versions of Firefox and VLC Media Player.
  - https://ftp.mozilla.org/pub/firefox/releases/104.0/win32/en-US/
  - https://get.videolan.org/vlc/1.1.1/win32/vlc-1.1.1-win32.exe
   
![Outdated Version of Firefox](https://i.imgur.com/wxU5Y8P.png)<br><br>
![Outdated Version of VLC Media Player](https://i.imgur.com/eb76yqQ.png)<br><br>

  Great! We've now created our Windows VM with outdated versions of Firefox and VLC Media Player installed. This machine will be used to find vulnerabilities for us to analyze and remediate. Next, we will download and install our Virtual Scanner from Qualys.

  </details>
  
</details>

<details>
<summary><h2><b>Section 2: Setting Up the Virtual Scanner</b></h2></summary>
  This section involves downloading the Qualys Virtual Scanner and configuring it to work with our virtual environment assuming we've already subscribed for the Community Edition of Qualys.<br><br>

  <details>
  <summary><h3>Step 1: Downloading the Scanner</h3></summary>
    
  - Access the Qualys platform and in the Getting Started section, click on `Download a virtual scanner`.
  - Start the wizard to configure our scanner.
  - Choose `Microsoft Azure Image` as the virtualization platform and provide the name `JohnsVA` for our scanner.
  - Take note of the provided Personalization Code for later use.

![Add New Virtual Scanner](https://i.imgur.com/PuvGrTN.png)<br><br>
![Start Wizard](https://i.imgur.com/b8xA6Vs.png)<br><br>
![Configure Platform and Name](https://i.imgur.com/pxRU6r4.png)<br><br>
![Personalization Code](https://i.imgur.com/BXVDIKb.png)<br><br>

  </details>

  <details>
  <summary><h3>Step 2: Configuring the Scanner Appliance</h3></summary>
 
  - Click the following link to open the "How to" guide for deploying the Qualys Scanner on the Azure Portal.
  - https://docs.qualys.com/en/integration/securing-azure/scan_in_azure/deploy_scanner_azure.htm
      
![1](https://i.imgur.com/txzmKil.png)<br><br>
![2](https://i.imgur.com/ZJnvvas.png)<br><br>
![3](https://i.imgur.com/S7xOfTI.png)<br><br>
![4](https://i.imgur.com/sOC8AJq.png)<br><br>

  </details>

  <details>
  <summary><h3>Step 3: Finalizing Scanner Setup</h3></summary>
  
  - Once the personalization is complete, verify that the scanner appears in our Qualys account with the correct LAN IP: `10.0.0.4`
  - We'll also perform a connectivity test from the Windows VM to confirm the scanner is reachable.
  - In the command prompt, run:<br><br>
    ```cmd
    ipconfig
    ping 10.0.0.4
    ```
  - **Our IP Addresses:**
    - Windows VM: `10.0.0.5`
    - Qualys Scanner: `10.0.0.4`
            
![Activation Verification](https://i.imgur.com/j0WK98s.png)<br><br>
![Appliances Tab](https://i.imgur.com/pNkc3qq.png)<br><br>
![Ping Test](https://i.imgur.com/a6o7UJQ.png)<br><br>

  Awesome! The Qualys Virtual Scanner is now up and running! In the next section, we'll configure our asset for an authenticated scan. 
  
  </details>

</details>

<details>
<summary><h2><b>Section 3: Configuring Asset for Authenticated Scan</b></h2></summary>
  Setting up for an authenticated scan ensures a more thorough assessment by allowing the scanner to log into the system. This allows for deeper vulnerability detection. Lets go over the steps to configure our asset, Windows VM, for an authenticated scan.<br><br>

  <details>
  <summary><h3>Step 1: Adding VM's IP to Qualys Asset Groups</h3></summary>
    
  - Navigate to the `Assets` tab on the Qualys platform
  - Click `Add IPs for Scanning`
  - Click on `New` > `IP Tracked Addresses`
  - Enter the IP : `10.0.0.5`
  - Save the configuration to ensure these IPs are included in scans

![Assets Tab](https://i.imgur.com/3SaidMH.png)<br><br>
![Add IPs for Scanning1](https://i.imgur.com/odQKq8d.png)<br><br>
![Add IPs for Scanning2](https://i.imgur.com/v0Z4gdS.png)<br><br>
![Add IPs for Scanning3](https://i.imgur.com/aT8IA9a.png)<br><br>
  
  </details>

  <details>
  <summary><h3>Step 2: Configuring Windows Firewall</h3></summary>
    
  - On our Windows VM, open the `Windows Defender Firewall` settings.
  - Disable the firewall for private and public networks to allow for unobstructed scanning.
    
![Windows Defender Firewall](https://i.imgur.com/lON4BHQ.png)<br><br>
![Windows Defender Firewall](https://i.imgur.com/Wd19tHy.png)<br><br>
![Turn Off Firewall](https://i.imgur.com/pYdbWAH.png)<br><br>

  Disabling Windows Defender Firewall on both private and public networks on the VM to ensure uninterrupted scanning by Qualys.

  </details>
  
  <details>
  <summary><h3>Step 3: Configuring Windows Services</h3></summary>
    
  - Navigate to `Services` and ensure that the `Remote Registry` service is set to `Automatic` and click `Start`. 
  - In `User Account Control` settings, adjust to `Never Notify`.
  - These will allow Qualys scans to access necessary Windows services.

![Services1](https://i.imgur.com/ReBiS2P.png)<br><br>
![Services2](https://i.imgur.com/hifxTFe.png)<br><br>
![Services3](https://i.imgur.com/YMDHjIz.png)<br><br>
![Services4](https://i.imgur.com/zVDXJQI.png)<br><br>

  </details>

  <details>
  <summary><h3>Step 4: Configuring Registry Editor</h3></summary>
    
  - Open `Registry Editor` and navigate to `Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System`
  - Right-click and choose `New` > `DWORD`
  - Fill in the following details:
    - Value Name: `LocalAccountTokenFilterPolicy`
    - Value Data: `1`
    - This will ensure that the scanning tool has the necessary permissions to check for vulnerabilities on the computer by adjusting the security setting in the computer's registry.
 
![Registry Editor](https://i.imgur.com/gWuZE4g.png)<br><br>
![Registry Editor1](https://i.imgur.com/W140kFX.png)<br><br>
![Registry Editor2](https://i.imgur.com/ZBHXccp.png)<br><br>

  </details>

  <details>
  <summary><h3>Step 5: Adding Credentials to Qualys</h3></summary>
    
  - Navigate back to the Qualys platform and go to the `Scans` tab.
  - Under the `Authentication` tab, click `New` then choose `Operating Systems` and select `Windows`.
  - For the `Record Title`, enter `Win10 Credentials`.
  - Select `Local` under `Windows Authentication` and fill out the login credentials for the Windows VM:
    - Username: `azureuser`
    - Password: `***********`
  - In the `IPs` section, input the IP address of the Windows VM: `10.0.0.5`.
  - With these credentials, Qualys will be able to perform a more thorough authenticated scan on our VM.

![Cred1](https://i.imgur.com/IRLYspJ.png)<br><br>
![Cred2](https://i.imgur.com/9Fyhwfw.png)<br><br>
![Cred3](https://i.imgur.com/U6EfAWb.png)<br><br>
![Cred4](https://i.imgur.com/WZ6rpVk.png)<br><br>

  </details>

  <details>
  <summary><h3>Step 6: Configuring the Option Profile for Scanning</h3></summary>
  
  The next step is to configure the scanning parameters within Qualys.

  - Select the `Option Profiles` tab and select `New` > `Option Profile` from the dropdown.
  - Enter `Basic Net Scan` as the title for the option profile and select our username as the owner.
  - Next, navigate to `Scan` section and choose `Standard Scan` to select about 1,900 common TCP ports for scanning. This is a balance between speed and coverage.
  - Lastly, scroll down and under `Authentication` select `Windows` checkbox. This will enable the scanner to use the provided Windows credentials during the scan.

![Option Profile](https://i.imgur.com/hc3GdDx.png)<br><br>
![Option Profile Title](https://i.imgur.com/6Cr5m2Q.png)<br><br>
![Scan TCP Ports](https://i.imgur.com/nnIVNhy.png)<br><br>
![Authentication](https://i.imgur.com/UO8B8sY.png)<br><br>

  Nice! After configuring these options, we'll save the profile and now, we can use this option profile to perform authenticated scans on our Windows VM, allowing for a more comprehensive vulnerability assessment.
  
  </details>

</details>

<details>
<summary><h2><b>Section 4: Initial Scan</b></h2></summary>
  
  Alright! Now we're ready to run our first authenicated scan! This will provide us with a view of gaps in our security and help us in securing them.

  - **Step 1: Creating a New Scan**
    - Navigate to `Scans` > `New` > `Scan`. The Launch Vulnerability Scan window will appear.
    - Set the following parameters:
      - Title: `Win10 Authenticated Scan`
      - Option Profile: `Basic Net Scan`
      - Scanner Appliance: `JohnsVA`
      - IPv4 Address: `10.0.0.5`
      - Click on `Launch` once the settings are set.

![Scan1-1](https://i.imgur.com/ELMjRoX.png)<br><br>
![Scan1-2](https://i.imgur.com/xRK1W0y.png)<br><br>
![Scan1-3](https://i.imgur.com/vYV4TkZ.png)<br><br>

With the completion of our initial scan, we are now advancing to the critical phase of our security assessment: Analysis and Prioritization. This phase is integral to the vulnerability management lifecycle, as it involves a detailed evaluation of the identified vulnerabilities, assigning priorities based on their severity, and methodically planning remediation efforts. By prioritizing vulnerabilities effectively, we ensure that the most critical threats are addressed first, thereby enhancing our overall security posture where it is most impactful.

</details>

<details>
<summary><h2><b>Section 5: Analyzing and Prioritizing Results</b></h2></summary>
  This phase begins with a thorough review and analysis of the scan's findings, focusing on prioritizing vulnerabilities based on their threat level. To deepen our understanding, we will examine the CVEs associated with critical vulnerabilities by consulting the MITRE CVE database and the National Vulnerability Database for comprehensive details. This approach ensures that our remediation efforts are precisely targeted where they are most needed.

  <details>
  <summary><h3>Understanding the Scan Summary</h3></summary>
    
  In vulnerability management, the severity of identified vulnerabilities determines the urgency and priority of remediation.

  **Critical and High Vulnerabilities:**
  - Severity 5 (Critical) and Severity 4 (High) vulnerabilities emerged as the most significant issues in our scan results.
  - These represent the most severe security threats, requiring immediate action due to the substantial risk they pose.
  - Our primary focus will be on remediating Severity 5 and 4 vulnerabilities, as they present the most critical risks to our network’s security.
  - Prompt remediation is crucial to mitigate the risk of potential breaches or security incidents.

  **Vulnerability Breakdown:**
  - Total Reported Vulnerabilities: 256
  - Severity 5 Vulnerabilities: 1
  - Severity 4 Vulnerabilities: 25 confirmed, 1 potential
  - Severity 3 Vulnerabilities: 34 confirmed, 2 potential
  - Severity 2 Vulnerabilities: 7 confirmed, 2 potential
  - Severity 1 Vulnerabilities: None reported
  - Information Gathered: 184
    - It is important to note that of the 256 vulnerabilities reported, 184 are categorized as "Information Gathered." These entries are not true vulnerabilities but rather informational items, such as best practices, configuration details, or other non-critical findings.
  - Security Risk Average:
    - An average security risk score of 5.0, indicating a critical risk posture, underscores the necessity for a comprehensive review and swift response plan.
    
By prioritizing the most severe vulnerabilities and distinguishing between actual vulnerabilities and informational findings, we can effectively allocate resources to enhance our security posture and reduce overall risk.

  ***For the remainder of this project, we will only focus on critical and high severity vulnerabilities***<br><br>

![Scan Summary](https://i.imgur.com/2aHvXYU.png)<br><br>

  </details>

  <details>
  <summary><h3>Reviewing Vulnerabilities by Category</h3></summary>
  
Categorizing vulnerabilities is essential for enhancing the effectiveness of targeted remediation, risk assessment, and trend analysis. Let’s examine how categorization supports these critical aspects of vulnerability management:

  - **Targeted Remediation:**
    - Categorization allows us to focus remediation efforts on areas that require specific attention or expertise. For example, vulnerabilities within the 'Local' category may indicate issues related to installed applications that require updates or patches. By targeting these specific areas, we can ensure that the most relevant and impactful remediation actions are taken.

  - **Risk Assessment:**
    - Understanding vulnerability categories enables more accurate risk prioritization. For instance, a high number of vulnerabilities in the 'Windows' category might highlight the need for urgent security updates. This categorization allows us to prioritize risks based on both severity and the nature of the threat, ensuring that critical issues are addressed first.

  - **Trend Analysis:**
    - Categorization also facilitates the identification of recurring vulnerability patterns. By recognizing trends, such as frequent vulnerabilities in certain categories, we can inform our security strategy and take proactive measures to prevent similar issues in the future.

  In our specific case:

  - **Local Category:**
    - With 47 confirmed vulnerabilities in the 'Local' category, this likely reflects the outdated applications installed on the system. Firefox, being a browser, may have numerous web protocols, plugins, and extensions, each serving as a potential attack surface.

  - **Windows Category:**
    - The 13 vulnerabilities in the 'Windows' category are likely related to missing security updates. These are critical as they often address known vulnerabilities that attackers could exploit. Given that no updates were performed prior to the scan, these 42 items may be attributed to unpatched Windows security updates.

  In conclusion, categorizing vulnerabilities not only streamlines the remediation process but also provides valuable insights for assessing security posture and developing security policies. In our case, prioritizing remediation efforts within the 'Local' and 'Windows' categories is essential to mitigate risks associated with outdated applications and unpatched systems.

![Vulnerabilities by Category](https://i.imgur.com/Vt1lhiz.png)<br><br>

  </details>

  <details>
  <summary><h3>Examining Detailed Results</h3></summary>
  
  The "Detailed Results" section provides a comprehensive list of individual vulnerabilities, with 1 critical severity level 5 vulnerability and numerous critical severity level 4 vulnerabilities prominently displayed:
  
  - **Critical Windows Security Updates:**
    - These entries indicate missing patches for known Windows vulnerabilities, which are essential to address immediately to ensure system security and prevent exploitation.
    
  - **VLC Media Player Vulnerabilities:**
    - Outdated versions of VLC Media Player exhibit several security gaps, highlighting the importance of regularly updating applications.

This section underscores the critical need to apply security patches to both operating systems and applications. Prompt remediation is vital to reducing the risk of potential cyber attacks and maintaining a secure environment.

![Detailed Results](https://i.imgur.com/Bsy8pjU.png)<br><br>

  </details>

  <details>
  <summary><h3>Investigating Individual Vulnerabilities</h3></summary>

  Here, we'll select a critical vulnerability to investigate further. Lets take a look at one thats related to VLC Media Player, a critical Memory Corruption Vulnerability. VLC Media Player is prone to a vulnerability that could be exploited by remote attackers to compromise a vulnerable system. This issue is caused by a memory corruption error in the "libdirectx" plugin when processing malformed NSV or AMV data.

  - **CVE ID:**
    - The associated CVE (Common Vulnerabilities and Exposures) ID is CVE-2010-3275, which serves as a unique identifier for this specific security flaw.
  
  - **Impact on Systems:**
    - If this vulnerability is successfully exploited, a remote attackers can execute arbitrary code by tricking a user into opening a malicious file or visiting a specially crafted web page.

  - **Solution:**
    - Upgrade to VLC Media Player version 1.1.8. The report includes links for patches, underscoring the availability of fixes that should be applied to mitigate the risk.

  - **Exploitability:**
    - We see mulitple entries for exploitability meaning attackers are actively exploiting this vulnerability. This increases the urgency to patch affected systems.

![Individual Vulnerability1](https://i.imgur.com/zWm9lc0.png)<br><br>

  - **Further Investigation:**
    - Following the CVE link leads to the MITRE CVE page, which details that the vulnerability relates to a "dangling pointer vulnerability", involving the libdirectx_plugin.dll in VideoLAN VLC Media Player before 1.1.8.
    - The NIST National Vulnerability Database (NVD) link provides additional insights, including the CVSS score.
    - Click on `Learn more at National Vulnerability Database (NVD)`

![Individual Vulnerability2](https://i.imgur.com/m66dDMW.png)<br><br>

  - **CVSS Score Explanation:**
    - The CVSS (Common Vulnerability Scoring System) score quantifies the severity of vulnerabilities; a score of 9.3 is categorized as High, indicating a severe level of risk.

![Individual Vulnerability3](https://i.imgur.com/fZu6smY.png)<br><br>

  Considering the critical severity, high CVSS score, and known exploitability, this vulnerability is a high-priority issue that must be addressed immediately to protect systems from potential compromise.
  
  </details>

</details>

<details>
<summary><h2><b>Section 6: Remediation and Second Scan</b></h2></summary>
  
In the realm of risk remediation, the strategy selected often hinges on the necessity and function of the associated applications. When an application is not critical to daily operations and presents significant security vulnerabilities, risk avoidance—such as uninstalling the application—may be the most prudent approach. This method effectively eliminates the threat from the environment, enhancing overall security without the continuous oversight required by risk reduction strategies. By opting for risk avoidance in these cases, we can strengthen our security posture and eliminate unnecessary vulnerabilities, thereby reducing the potential for future threats.<br><br>
  
- **Step 1: Remediation: Uninstalling Outdated Applications:**
  - We identified VLC Media Player as an outdated version with multiple vulnerabilities. To mitigate the risk, we choose to uninstall the applications from our system.
  
![Uninstalling VLC Media Player](https://i.imgur.com/nqLIlEW.png)<br><br>

  With the outdated applications removed, we then prepare for a second vulnerability scan to verify the effectiveness of our remediation actions.

- **Step 2: Performing Second Scan:**
  - Select the scan that was just completed, select the dropdown arrow, and select `relaunch`.
  - Launch the Scan and when finished, click `View Results`.
  
![Second Scan Setup](https://i.imgur.com/Fdjstcq.png)<br><br>
  
![Second Scan Launch](https://i.imgur.com/q0ZJycv.png)<br><br>

- **Step 3: Review Second Scan Results:**
  
  The second scan results indicate a significant reduction in the number of vulnerabilities compared to the first scan. Here are some bullet points that outline the key changes:

  - **Total Vulnerabilities Reduced:**
    - The total number of vulnerabilities decreased from 256 to 32, showing a substantial improvement in security posture.

  - **Critical and High-severity Vulnerabilities Decreased:**
    - Severity 5 vulnerabilities dropped from 1 to 0.
    - Severity 4 vulnerabilities saw a reduction from 25 to 0.
  
  - **'Local' Category Improvement:**
    - The 'Local' category, which initially had 47 confirmed vulnerabilities, no longer appears among the top categories, suggesting that local issues were effectively remediated.

  - **'Windows' and 'Security Policy' Categories:**
    - The 'Windows' category, which initially had 13 confirmed vulnerabilities, reduced to only 1 confirmed vulnerability, indicating that the remediation process was executed effectively.

  - **Information Gathered:**
    - The 'Information Gathered' category showed a decrease in entries, from 184 to 26, which may include lower-risk findings but still signifies a more secure and compliant environment.

These changes underscore the effectiveness of the remediation actions taken, such as uninstalling outdated applications like VLC Media Player, and demonstrate the value of conducting follow-up scans as part of a comprehensive vulnerability management process.
  
![Second Scan Summary](https://i.imgur.com/3Fyz8zi.png)<br><br>

- **Step 4: Reflect on Remaining Vulnerabilities:**
  - The detailed results of the second scan highlighted the remaining issues that still require attention.
  
![Second Scan Detailed Results](https://i.imgur.com/v9kZRH3.png)<br><br>

  These steps confirmed that uninstalling the outdated application was an effective measure in reducing our exposure to potential threats. The second scan's outcomes dictate our next actions in the continuous process of vulnerability management.

</details>

<details>
<summary><h2><b>Reflections</b></h2></summary>

Fin! In this project, we navigated the entire spectrum of the vulnerability management cycle within a simulated corporate environment. This hands-on experience highlighted the crucial balance between theoretical knowledge and practical application.

Compiling the trend report revealed significant improvements in our security posture throughout each phase, validating the effectiveness of proactive vulnerability management.

Reflecting on this journey, I’ve gained a deeper appreciation for the relentless nature of cybersecurity and the necessity of continuous adaptation and learning. This project has not only sharpened my technical skills but also strengthened my commitment to the ongoing mission of cyber defense.

</details>
